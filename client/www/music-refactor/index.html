<!DOCTYPE html>
<head>
</head>
<body>
  <script src='./DroneElement.js'></script>
  <script>
  var test = function( scale ) {
    // use scale to produce an array with all the
    // midi notes from that scale between 36 and 84
    var notes = [];
    for( var i = 48; i < 84; i += 12 ) {
      for( var j = 0; j < scale.length; j++ ) {
        notes.push( scale[ j ] + i );
      }
    }
    // Then choose all 8 note patterns that don't
    // choose two notes that are less than 2 indices apart
    // in the notes array
    var chords = [];
    for( var i = ( 1 << 8 ); i < ( 1 << notes.length ); i++ ) {
      var chord = [];
      for( var j = 0; j < notes.length; j++ ) {
        if( ( i >> j ) % 2 === 1 ) {
          if( j > 1 ) {
            if( ( i >> j - 1 ) % 2 === 0 &&
                ( i >> j + 1 ) % 2 === 0 ) {
              chord.push( notes[ j ] );
            }
          } else {
            if( ( i >> j + 1 ) % 2 === 0 ) {
              chord.push( notes[ j ] );
            }
          }
        }
      }
      if( chord.length === 8 ) {
        chords.push( chord );
      }
    }
    return chords;
  };
  var chords = test( [1, 2, 4, 5, 7, 9, 11]);
  console.log( chords.length );
  var chord = chords[ ~~( Math.random( ) * chords.length ) ]
  chord = chord.sort( function( ) {
    return Math.random( ) - 0.5;
  });
    window.context = new AudioContext( );
    var drones = [];
    for( var i = 0; i < 8; i++ ) {
      drones[ i ] = context.createDroneElement( chord[ i ] );
      drones[ i ].connect( context.destination );
      drones[ i ].start( context.currentTime );
      drones[ i ].stop( context.currentTime + 1 );
    }

  </script>
</body>